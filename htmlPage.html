<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    #chatlist { float: bottom; }
  </style>
  <script>
    function fnMove(seq){
        var offset = $(seq).offset();
        $('html, body').animate({scrollTop : offset.top}, 400);
    }

    $(document).ready(function(){
      var socket = io.connect();  // 소켓서버를 추출합니다.

      socket.on('serverMsg',(data)=>{
        // 전송받은 데이터를 출력합니다.
        let msgBody = '';
        msgBody += '<li>';
        msgBody += '<h3>' + data.name + '</h3>';
        msgBody += '<h2>' + data.message + '</h2>';
        msgBody += '<p>' + data.date + '</p>';
        msgBody += '</li>';

        $(msgBody).appendTo('#content');  //id=content 인 문서뒤에 메시지바디를 추가합니다.
        $('#content').listview('refresh'); // 리스트뷰를 리프래쉬합니다.
        //fnMove('#btnChat');

      });

      $('button').click(function () {
        socket.emit('clientMsg',{
          name: $('#name').val(),
          message: $('#message').val(),
          date: new Date().toUTCString()
        });
        $('#message').val('');
      });

      $('#message').keydown(function (event) {
        if(event.which == 13){
          $('button').click();
          return false;
        }
      });
    });
  </script>
  <title>Mobile Chat</title>
</head>
<body>
  <div data-role="page">
    <div data-role="header" data-position="fixed">
      <h1>Socket.io Chatting Program</h1>
    </div>
    <div data-role="content">
      <h3>Nick Name</h3>
      <input id="name"/>
      <a data-role="button" href="#chatpage">Start</a>
    </div>
  </div>
  <div data-role="page" id="chatpage">
    <div data-role="header" data-position="fixed">
      <h1>Socket.io Chatting Program</h1>
    </div>
    <div data-role="content" id="chatlist">
      <ul id="content" data-role="listview" data-inset="true">

      </ul>
      <div id="spaceForScroll"></div>
    </div>
    <div data-role="footer" data-position="fixed" id="footer">
      <input id="message"/>
      <button id="btnChat">Button</button>
    </div>
  </div>
</body>
</html>
